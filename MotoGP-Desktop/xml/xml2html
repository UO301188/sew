#!/usr/bin/env python3
"""
xml2html.py
Lee 'circuitoEsquema.xml' y genera 'InfoCircuito.html'.
Usa xml.etree.ElementTree y expresiones XPath.
No incluye datos del origen ni de los tramos.
"""

import xml.etree.ElementTree as ET
from pathlib import Path

class Html:
    def __init__(self, title, css_link="estilo.css"):
        self.lines = []
        self.title = title
        self.css_link = css_link

    def open_html(self):
        self.lines.append('<!DOCTYPE html>')
        self.lines.append('<html lang="es">')
        self.lines.append('<head>')
        self.lines.append('    <meta charset="UTF-8">')
        self.lines.append(f'    <title>{self.title}</title>')
        self.lines.append(f'    <link rel="stylesheet" href="{self.css_link}">')
        self.lines.append('</head>')
        self.lines.append('<body>')

    def add_header(self, text):
        self.lines.append(f'    <header><h1>{text}</h1></header>')

    def add_table(self, caption, data):
        self.lines.append(f'    <section>')
        self.lines.append(f'    <h2>{caption}</h2>')
        self.lines.append('    <table>')
        for key, value in data.items():
            self.lines.append(f'        <tr><th>{key}</th><td>{value}</td></tr>')
        self.lines.append('    </table>')
        self.lines.append('    </section>')

    def add_footer(self, text):
        self.lines.append(f'    <footer><p>{text}</p></footer>')

    def close_html(self):
        self.lines.append('</body>')
        self.lines.append('</html>')

    def write(self, filename):
        Path(filename).write_text("\n".join(self.lines), encoding="utf-8")

# --- Lectura del XML y generación del HTML ---
def main():
    XML_IN = Path("circuitoEsquema.xml")
    HTML_OUT = Path("InfoCircuito.html")

    tree = ET.parse(XML_IN)
    root = tree.getroot()
    ns = {"ns": "http://www.uniovi.es"}

    # Extraer datos con XPath
    nombre = root.findtext(".//ns:nombre", namespaces=ns) or "Desconocido"
    pais = root.findtext(".//ns:pais", namespaces=ns) or "Desconocido"
    longitud = root.findtext(".//ns:longitud", namespaces=ns) or "N/A"
    curvas = root.findtext(".//ns:curvas", namespaces=ns) or "N/A"
    recta = root.findtext(".//ns:rectaPrincipal", namespaces=ns) or "N/A"

    datos = {
        "Nombre": nombre,
        "País": pais,
        "Longitud": f"{longitud} m",
        "Curvas": curvas,
        "Recta principal": f"{recta} m",
    }

    # Generar HTML
    html = Html("Información del Circuito")
    html.open_html()
    html.add_header("Información del Circuito")
    html.add_table("Datos generales", datos)
    html.add_footer("Generado automáticamente desde circuitoEsquema.xml")
    html.close_html()
    html.write(HTML_OUT)

    print(f"Archivo HTML generado correctamente: {HTML_OUT}")

if __name__ == "__main__":
    main()
